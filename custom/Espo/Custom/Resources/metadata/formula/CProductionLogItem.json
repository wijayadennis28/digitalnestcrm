{
    "beforeSaveCustomScript": "name=product.name;\n\n\n$productionLog = record\\fetch('CProductionLog', cProductionLogId);\n\n$amount = qtyProduced;\n$warehouseId = object\\get($productionLog, 'warehouseId');\n\n$status = entity\\isNew();\nif ($status) {\n    record\\create('InventoryTransaction',\n        'type', 'Transfer',\n        'quantity', $amount,\n        'productId', productId,\n        'warehouseId', $warehouseId,\n        'productionLogId', cProductionLogId,\n    );\n} else if ($isDeleted) {\n    // Delete InventoryTransaction when data is deleted\n    $inventoryTransactionId = record\\findOne('InventoryTransaction', 'createdAt', 'desc', 'productionLogId=', cProductionLogId, 'productId=', productId);\n    if ($inventoryTransactionId) {\n        record\\delete('InventoryTransaction', $inventoryTransactionId);\n    }\n} else {\n    $inventoryTransactionId = record\\findOne('InventoryTransaction', 'createdAt', 'desc', 'productionLogId=', cProductionLogId, 'productId=', productId);\n    \n    record\\update('InventoryTransaction', $inventoryTransactionId, 'quantity', $amount);\n}"
}