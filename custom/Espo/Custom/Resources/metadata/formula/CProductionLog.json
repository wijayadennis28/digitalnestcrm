{
    "beforeSaveCustomScript": "// Generate Batch Code\nbatchCode=string\\concatenate(total, producedAt, cProductFormula.name, shift, machine);\nname=batchCode;\n\n\n// Create/update Inventory Transaction\nif (entity\\isNew()) {\n    record\\create('InventoryTransaction',\n        'type', 'Transfer',\n        'quantity', total,\n        'productId', productId,\n        'warehouseId', warehouseId,\n        'inventoryNumberId', inventoryNumberId,\n        'productionLogId', id,\n    );\n    if (productionStatus == 'Failed') {\n        record\\create('InventoryTransaction',\n            'type', 'Transfer',\n            'quantity', totalRecycledProduct,\n            'productId', recycledProductId,\n            'warehouseId', warehouseId,\n            'inventoryNumberId', inventoryNumberId,\n            'productionLogId', id,\n        );\n    }\n} else {\n    $inventoryTransactionId = record\\findOne('InventoryTransaction', 'createdAt', 'desc', 'productionLogId=', id, 'productId=', productId);\n    record\\update('InventoryTransaction', $inventoryTransactionId,\n        'type', 'Transfer',\n        'quantity', total,\n        'productId', productId,\n        'warehouseId', warehouseId,\n        'inventoryNumberId', inventoryNumberId,\n    );\n    if (productionStatus == 'Failed') {\n        $recycledProductTransactionId = record\\findOne('InventoryTransaction', 'createdAt', 'desc', 'productionLogId=', id, 'productId=', recycledProductId);\n        record\\update('InventoryTransaction', $recycledProductTransactionId,\n            'type', 'Transfer',\n            'quantity', totalRecycledProduct,\n            'productId', recycledProductId,\n            'warehouseId', warehouseId,\n            'inventoryNumberId', inventoryNumberId,\n        );\n    }\n}"
}